<!-- src/app/components/cliente/mis-compras/mis-compras.html -->
<div class="mis-compras-page">
  <div class="page-header">
    <h1>Mis Compras</h1>
    <p>Historial completo de tus pedidos y compras</p>
  </div>

  <!-- Estad√≠sticas R√°pidas -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <h3>{{ estadisticas.totalCompras }}</h3>
        <p>Total Compras</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <h3>${{ estadisticas.totalGastado | number:'1.2-2' }}</h3>
        <p>Total Gastado</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üöö</div>
      <div class="stat-content">
        <h3>{{ estadisticas.comprasEnviadas }}</h3>
        <p>Enviadas</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <h3>{{ estadisticas.comprasEntregadas }}</h3>
        <p>Entregadas</p>
      </div>
    </div>
  </div>

  <!-- Lista de Compras -->
  <div class="compras-container">
    @if (loading()) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Cargando compras...</p>
      </div>
    } @else if (comprasFiltradas.length === 0) {
      <div class="empty-state">
        <div class="empty-icon">üõí</div>
        <h3>No se encontraron compras</h3>
        <p>No hay compras que coincidan con los filtros aplicados.</p>
        <div class="empty-actions">
          <button (click)="limpiarFiltros()" class="btn btn-outline">
            Limpiar Filtros
          </button>
          <button (click)="verProductos()" class="btn btn-primary">
            Explorar Productos
          </button>
        </div>
      </div>
    } @else {
      <div class="compras-list">
        @for (compra of comprasFiltradas; track compra.id) {
          <div class="compra-card">
            <div class="compra-header">
              <div class="compra-info">
                <h3>Orden {{ compra.numeroVenta }}</h3>
                <p class="compra-fecha">{{ compra.fechaVenta | date:'dd/MM/yyyy HH:mm' }}</p>
              </div>
              <div class="compra-status">
                <span class="status-badge" [class]="'estado-' + compra.estadoVenta.toLowerCase()">
                  {{ compra.estadoVenta }}
                </span>
                <span class="compra-total">${{ compra.total | number:'1.2-2' }}</span>
              </div>
            </div>

            <div class="compra-productos">
              @for (detalle of compra.detalles; track detalle.id) {
                <div class="producto-item">
                  <div class="producto-info">
                    <h4>{{ detalle.nombreProducto }}</h4>
                    <p>Cantidad: {{ detalle.cantidad }} x ${{ detalle.precioUnitario | number:'1.2-2' }}</p>
                  </div>
                  <div class="producto-total">
                    ${{ detalle.subtotal | number:'1.2-2' }}
                  </div>
                </div>
              }
            </div>

            <div class="compra-footer">
              <div class="compra-acciones">
                <button (click)="verDetalleCompra(compra)" class="btn btn-outline btn-sm">
                  Ver Detalles
                </button>
                
                @if (compra.estadoVenta === 'Entregado') {
                  <button (click)="descargarFactura(compra)" class="btn btn-outline btn-sm">
                    üìÑ Factura
                  </button>
                  <button (click)="calificarCompra(compra)" class="btn btn-primary btn-sm">
                    ‚≠ê Calificar
                  </button>
                }
                
                @if (compra.estadoVenta === 'Enviado') {
                  <button (click)="rastrearPedido(compra)" class="btn btn-primary btn-sm">
                    üìç Rastrear
                  </button>
                }
                
                @if (compra.estadoVenta === 'Pendiente' || compra.estadoVenta === 'Procesando') {
                  <button (click)="cancelarCompra(compra)" class="btn btn-outline btn-sm btn-danger">
                    ‚ùå Cancelar
                  </button>
                }
              </div>
              
              <div class="compra-resumen">
                <div class="resumen-linea">
                  <span>Subtotal:</span>
                  <span>${{ compra.subtotal | number:'1.2-2' }}</span>
                </div>
                <div class="resumen-linea">
                  <span>IVA:</span>
                  <span>${{ compra.impuestos | number:'1.2-2' }}</span>
                </div>
                <div class="resumen-linea total">
                  <span>Total:</span>
                  <span>${{ compra.total | number:'1.2-2' }}</span>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Paginaci√≥n -->
  @if (totalCompras > pageSize) {
    <div class="pagination-container">
      <div class="pagination-info">
        Mostrando {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalCompras) }} de {{ totalCompras }} compras
      </div>
      <div class="pagination-controls">
        <button 
          (click)="cambiarPagina(currentPage - 1)" 
          [disabled]="currentPage === 1"
          class="btn btn-outline btn-sm">
          ‚Üê Anterior
        </button>
        
        @for (page of getPaginas(); track page) {
          <button 
            (click)="cambiarPagina(page)"
            [class.active]="page === currentPage"
            class="btn btn-outline btn-sm page-btn">
            {{ page }}
          </button>
        }
        
        <button 
          (click)="cambiarPagina(currentPage + 1)" 
          [disabled]="currentPage === totalPaginas"
          class="btn btn-outline btn-sm">
          Siguiente ‚Üí
        </button>
      </div>
    </div>
  }
</div>

<!-- Modal de Detalles de Compra -->
@if (showDetalleModal()) {
  <div class="modal-overlay" (click)="cerrarModalDetalle()">
    <div class="modal-container modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Detalles de la Compra</h2>
        <button (click)="cerrarModalDetalle()" class="btn-close">‚úï</button>
      </div>
      
      @if (compraSeleccionada) {
        <div class="modal-body">
          <div class="detalle-grid">
            <div class="detalle-section">
              <h3>Informaci√≥n del Pedido</h3>
              <div class="info-grid">
                <div class="info-item">
                  <label>N√∫mero de Orden:</label>
                  <span>{{ compraSeleccionada.numeroVenta }}</span>
                </div>
                <div class="info-item">
                  <label>Fecha:</label>
                  <span>{{ compraSeleccionada.fechaVenta | date:'dd/MM/yyyy HH:mm' }}</span>
                </div>
                <div class="info-item">
                  <label>Estado:</label>
                  <span class="status-badge" [class]="'estado-' + compraSeleccionada.estadoVenta.toLowerCase()">
                    {{ compraSeleccionada.estadoVenta }}
                  </span>
                </div>
                <div class="info-item">
                  <label>M√©todo de Pago:</label>
                  <span>{{ compraSeleccionada.metodoPago }}</span>
                </div>
              </div>
            </div>

            <div class="detalle-section">
              <h3>Productos</h3>
              <div class="productos-detalle">
                @for (detalle of compraSeleccionada.detalles; track detalle.id) {
                  <div class="producto-detalle">
                    <div class="producto-info">
                      <h4>{{ detalle.nombreProducto }}</h4>
                      <p>{{ detalle.cantidad }} unidades x ${{ detalle.precioUnitario | number:'1.2-2' }}</p>
                    </div>
                    <div class="producto-subtotal">
                      ${{ detalle.subtotal | number:'1.2-2' }}
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>

          <div class="resumen-total">
            <div class="resumen-linea">
              <span>Subtotal:</span>
              <span>${{ compraSeleccionada.subtotal | number:'1.2-2' }}</span>
            </div>
            <div class="resumen-linea">
              <span>IVA (16%):</span>
              <span>${{ compraSeleccionada.impuestos | number:'1.2-2' }}</span>
            </div>
            <div class="resumen-linea total">
              <span>Total:</span>
              <span>${{ compraSeleccionada.total | number:'1.2-2' }}</span>
            </div>
          </div>

          @if (compraSeleccionada.observaciones) {
            <div class="observaciones">
              <h4>Observaciones:</h4>
              <p>{{ compraSeleccionada.observaciones }}</p>
            </div>
          }
        </div>
        
        <div class="modal-footer">
          <button (click)="cerrarModalDetalle()" class="btn btn-outline">
            Cerrar
          </button>
          @if (compraSeleccionada.estadoVenta === 'Entregado') {
            <button (click)="descargarFactura(compraSeleccionada)" class="btn btn-primary">
              üìÑ Descargar Factura
            </button>
          }
        </div>
      }
    </div>
  </div>
} Filtros y B√∫squeda
  <div class="filtros-section">
    <div class="filtros-container">
      <div class="search-box">
        <input 
          type="text" 
          placeholder="Buscar por n√∫mero de orden o producto..." 
          [(ngModel)]="filtros.busqueda"
          (input)="aplicarFiltros()"
          class="form-input">
      </div>
      <div class="filter-group">
        <select [(ngModel)]="filtros.estado" (change)="aplicarFiltros()" class="form-select">
          <option value="">Todos los estados</option>
          <option value="Pendiente">Pendiente</option>
          <option value="Procesando">Procesando</option>
          <option value="Enviado">Enviado</option>
          <option value="Entregado">Entregado</option>
          <option value="Cancelado">Cancelado</option>
        </select>
      </div>
      <div class="filter-group">
        <select [(ngModel)]="filtros.periodo" (change)="aplicarFiltros()" class="form-select">
          <option value="">Todos los per√≠odos</option>
          <option value="ultima-semana">√öltima semana</option>
          <option value="ultimo-mes">√öltimo mes</option>
          <option value="ultimos-3-meses">√öltimos 3 meses</option>
          <option value="ultimo-a√±o">√öltimo a√±o</option>
        </select>
      </div>
    </div>
  </div>

