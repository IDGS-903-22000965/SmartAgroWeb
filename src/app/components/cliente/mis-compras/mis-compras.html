<!-- Mis Compras con dise√±o Tailwind manteniendo funcionalidad Angular completa -->
<div class="min-h-screen bg-gradient-to-br from-green-900 via-green-700 to-lime-600 p-4 lg:p-8">
  <div class="max-w-7xl mx-auto mis-compras">
    
    <!-- Header de la p√°gina -->
    <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 lg:p-8 mb-8 page-header">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
        <div class="mb-4 lg:mb-0">
          <h1 class="text-3xl lg:text-4xl font-bold text-green-800 mb-2">
            üì¶ Mis Compras
          </h1>
          <p class="text-gray-600">Revisa el historial de tus compras y productos adquiridos</p>
        </div>
      </div>
    </div>

    <!-- Estados de carga/error -->
    <div *ngIf="loading" class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-12 text-center loading-container">
      <div class="w-12 h-12 border-4 border-green-200 border-t-green-600 rounded-full animate-spin mx-auto mb-4 spinner"></div>
      <p class="text-gray-600 font-medium">Cargando informaci√≥n de compras...</p>
    </div>

    <div *ngIf="error && !loading" class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-12 text-center error-container">
      <div class="text-6xl mb-4">‚ö†Ô∏è</div>
      <h3 class="text-xl font-bold text-gray-900 mb-2">Error</h3>
      <p class="text-gray-600 mb-4">{{ error }}</p>
      <button 
        class="px-6 py-3 bg-gradient-to-r from-green-600 to-lime-500 text-white rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 font-medium" 
        (click)="loadData()">
        Reintentar
      </button>
    </div>

    <!-- Contenido principal -->
    <div *ngIf="!loading && !error" class="content">
      
      <!-- Navegaci√≥n por tabs -->
      <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 mb-8 tabs-navigation">
        <nav class="flex gap-2 overflow-x-auto">
          <button 
            class="px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all duration-200 tab-button"
            [class]="activeTab === 'compras' ? 
              'bg-gradient-to-r from-green-600 to-lime-500 text-white shadow-lg active' : 
              'bg-white/80 text-gray-700 hover:bg-green-50 hover:text-green-700 border border-gray-200'"
            (click)="setActiveTab('compras')">
            üõí Historial de Compras
          </button>
          <button 
            class="px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all duration-200 tab-button"
            [class]="activeTab === 'productos' ? 
              'bg-gradient-to-r from-green-600 to-lime-500 text-white shadow-lg active' : 
              'bg-white/80 text-gray-700 hover:bg-green-50 hover:text-green-700 border border-gray-200'"
            (click)="setActiveTab('productos')">
            üì¶ Mis Productos
          </button>
          <button 
            class="px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap transition-all duration-200 tab-button"
            [class]="activeTab === 'estadisticas' ? 
              'bg-gradient-to-r from-green-600 to-lime-500 text-white shadow-lg active' : 
              'bg-white/80 text-gray-700 hover:bg-green-50 hover:text-green-700 border border-gray-200'"
            (click)="setActiveTab('estadisticas')">
            üìä Estad√≠sticas
          </button>
        </nav>
      </div>

      <!-- Tab: Historial de Compras -->
      <div *ngIf="activeTab === 'compras'" class="tab-content">
        
        <!-- Filtros -->
        <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 mb-8 filters-section">
          <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 filters-grid">
            <!-- Buscador -->
            <div class="filter-group">
              <label class="block text-sm font-semibold text-green-800 mb-2">Buscar:</label>
              <div class="relative">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg">üîç</span>
                <input 
                  type="text" 
                  [(ngModel)]="filters.busqueda"
                  placeholder="N√∫mero de venta o producto..."
                  class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white/80 backdrop-blur-sm filter-input">
              </div>
            </div>
            
            <!-- Estado -->
            <div class="filter-group">
              <label class="block text-sm font-semibold text-green-800 mb-2">Estado:</label>
              <select 
                [(ngModel)]="filters.estado" 
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white/80 backdrop-blur-sm filter-select">
                <option value="">Todos los estados</option>
                <option *ngFor="let estado of estados" [value]="estado">
                  {{ estado }}
                </option>
              </select>
            </div>
            
            <!-- A√±o -->
            <div class="filter-group">
              <label class="block text-sm font-semibold text-green-800 mb-2">A√±o:</label>
              <select 
                [(ngModel)]="filters.anio" 
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white/80 backdrop-blur-sm filter-select">
                <option value="">Todos los a√±os</option>
                <option *ngFor="let anio of availableYears" [value]="anio">
                  {{ anio }}
                </option>
              </select>
            </div>
            
            <!-- Limpiar filtros -->
            <div class="filter-group">
              <label class="block text-sm font-semibold text-green-800 mb-2">Acciones:</label>
              <button 
                class="w-full px-4 py-3 bg-gradient-to-r from-gray-600 to-gray-500 text-white rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 font-medium" 
                (click)="clearFilters()">
                <i class="fas fa-times"></i> Limpiar Filtros
              </button>
            </div>
          </div>
        </div>

        <!-- Lista de compras -->
        <div class="space-y-6 purchases-list">
          <!-- Sin compras -->
          <div *ngIf="filteredPurchases.length === 0" class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-12 text-center no-data">
            <div class="text-6xl mb-4">üì¶</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">No hay compras</h3>
            <p class="text-gray-600">No se encontraron compras con los filtros seleccionados</p>
          </div>

          <!-- Tarjetas de compras -->
          <div 
            *ngFor="let purchase of filteredPurchases" 
            class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 purchase-card">
            
            <!-- Header de la compra -->
            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between mb-6 purchase-header">
              <div class="flex items-start gap-4 mb-4 lg:mb-0 purchase-info">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-500 rounded-full flex items-center justify-center text-white font-bold shadow-lg">
                  <i class="fas fa-receipt"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-gray-900">{{ purchase.numeroVenta }}</h3>
                  <p class="text-gray-600 purchase-date">
                    <i class="fas fa-calendar-alt"></i> {{ formatDate(purchase.fechaVenta) }}
                  </p>
                  <span class="inline-block px-3 py-1 rounded-full text-sm font-medium mt-2 purchase-status" [ngClass]="{
                    'bg-green-100 text-green-800 border border-green-200': purchase.estadoVenta === 'Entregado',
                    'bg-yellow-100 text-yellow-800 border border-yellow-200': purchase.estadoVenta === 'Procesando', 
                    'bg-blue-100 text-blue-800 border border-blue-200': purchase.estadoVenta === 'Enviado',
                    'bg-red-100 text-red-800 border border-red-200': purchase.estadoVenta === 'Cancelado',
                    'bg-gray-100 text-gray-800 border border-gray-200': purchase.estadoVenta === 'Pendiente'
                  }">
                    {{ purchase.estadoVenta }}
                  </span>
                </div>
              </div>
              
              <div class="text-right purchase-total">
                <h4 class="text-2xl font-bold text-green-700">{{ formatCurrency(purchase.total) }}</h4>
                <p class="text-gray-600">
                  <i class="fas fa-box"></i> {{ purchase.cantidadProductos }} producto(s)
                </p>
              </div>
            </div>

            <!-- Detalles de la compra -->
            <div class="purchase-details">
              <!-- Resumen de productos -->
              <div class="bg-gray-50/80 backdrop-blur-sm rounded-xl p-4 mb-4 products-summary">
                <h4 class="font-semibold text-gray-900 mb-3">
                  <i class="fas fa-shopping-bag text-purple-600"></i> Productos:
                </h4>
                <div class="space-y-3 products-list">
                  <div 
                    *ngFor="let producto of purchase.productos" 
                    class="flex items-center gap-4 p-3 bg-white rounded-lg border border-gray-200/50 product-item">
                    <div class="w-12 h-12 rounded-lg overflow-hidden shadow-sm bg-gray-100 flex items-center justify-center">
                      <img 
                        *ngIf="producto.imagenProducto" 
                        [src]="producto.imagenProducto" 
                        [alt]="producto.nombreProducto"
                        class="w-full h-full object-cover product-image">
                      <span *ngIf="!producto.imagenProducto" class="text-gray-400">üì¶</span>
                    </div>
                    <div class="flex-1 product-info">
                      <h5 class="font-semibold text-gray-900">{{ producto.nombreProducto }}</h5>
                      <p class="text-sm text-gray-600">
                        Cantidad: <span class="font-medium">{{ producto.cantidad }}</span> | 
                        Precio: <span class="font-medium">{{ formatCurrency(producto.precioUnitario) }}</span>
                      </p>
                    </div>
                    <div class="text-right product-total">
                      <span class="font-bold text-gray-900">{{ formatCurrency(producto.subtotal) }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Acciones -->
              <div class="flex gap-3 flex-wrap purchase-actions">
                <button 
                  class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-500 text-white rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 font-medium"
                  [routerLink]="['/cliente/mis-compras', purchase.id]">
                  <i class="fas fa-eye"></i> Ver Detalle
                </button>
                <button 
                  *ngIf="purchase.metodoPago" 
                  class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg font-medium cursor-default"
                  disabled>
                  <i class="fas fa-credit-card"></i> {{ purchase.metodoPago }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Mis Productos -->
      <div *ngIf="activeTab === 'productos'" class="tab-content">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 products-grid">
          
          <!-- Sin productos -->
          <div *ngIf="ownedProducts.length === 0" class="col-span-full bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-12 text-center no-data">
            <div class="text-6xl mb-4">üì¶</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Sin productos</h3>
            <p class="text-gray-600">A√∫n no has adquirido ning√∫n producto</p>
          </div>

          <!-- Tarjetas de productos -->
          <div 
            *ngFor="let product of ownedProducts" 
            class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 product-card">
            
            <!-- Imagen del producto -->
            <div class="w-full h-48 rounded-xl overflow-hidden shadow-lg mb-4 bg-gray-100 flex items-center justify-center product-image-container">
              <img 
                *ngIf="product.imagenPrincipal" 
                [src]="product.imagenPrincipal" 
                [alt]="product.nombreProducto"
                class="w-full h-full object-cover product-image">
              <div *ngIf="!product.imagenPrincipal" class="text-6xl text-gray-400 product-placeholder">
                üì¶
              </div>
            </div>

            <!-- Contenido del producto -->
            <div class="product-content">
              <h3 class="text-xl font-bold text-gray-900 mb-2">{{ product.nombreProducto }}</h3>
              <p *ngIf="product.descripcionProducto" class="text-gray-600 text-sm mb-4 line-clamp-2 product-description">
                {{ product.descripcionProducto }}
              </p>

              <!-- Estad√≠sticas -->
              <div class="bg-gray-50/80 backdrop-blur-sm rounded-xl p-4 mb-4 product-stats">
                <div class="grid grid-cols-2 gap-3">
                  <div class="stat">
                    <span class="text-sm text-gray-600 stat-label">Total Comprado:</span>
                    <span class="font-semibold text-gray-900 stat-value">{{ product.totalComprado }}</span>
                  </div>
                  <div class="stat">
                    <span class="text-sm text-gray-600 stat-label">Compras:</span>
                    <span class="font-semibold text-gray-900 stat-value">{{ product.numeroCompras }}</span>
                  </div>
                  <div class="stat">
                    <span class="text-sm text-gray-600 stat-label">Gastado:</span>
                    <span class="font-semibold text-green-700 stat-value">{{ formatCurrency(product.totalGastado) }}</span>
                  </div>
                  <div class="stat">
                    <span class="text-sm text-gray-600 stat-label">Calificaci√≥n:</span>
                    <div class="stat-value">
                      <div class="flex items-center gap-1">
                        <span *ngFor="let star of [1,2,3,4,5]" 
                              class="text-sm" 
                              [class]="star <= product.calificacionPromedio ? 'text-yellow-500' : 'text-gray-300'">‚≠ê</span>
                        <span class="text-xs text-gray-600">({{ product.totalComentarios }})</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Fechas -->
              <div class="text-sm text-gray-600 mb-4 product-dates space-y-1">
                <p><span class="font-semibold">Primera compra:</span> {{ formatDate(product.primeraCompra) }}</p>
                <p><span class="font-semibold">√öltima compra:</span> {{ formatDate(product.ultimaCompra) }}</p>
              </div>

              <!-- Acciones -->
              <div class="flex gap-3 product-actions">
                <button 
                  class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-500 text-white rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 font-medium"
                  [routerLink]="['/cliente/documentacion']"
                  [queryParams]="{producto: product.productoId}">
                  <i class="fas fa-book"></i> Ver Recursos
                </button>
                <button 
                  *ngIf="!product.yaComento"
                  class="flex-1 px-4 py-2 bg-gradient-to-r from-yellow-600 to-orange-500 text-white rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 font-medium"
                  (click)="openCommentModal(product)">
                  <i class="fas fa-star"></i> Comentar
                </button>
                <span 
                  *ngIf="product.yaComento"
                  class="flex-1 px-4 py-2 bg-green-100 text-green-800 rounded-lg font-medium text-center commented-badge">
                  <i class="fas fa-check-circle"></i> Ya comentado
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Estad√≠sticas -->
      <div *ngIf="activeTab === 'estadisticas'" class="tab-content">
        <div *ngIf="stats" class="stats-container">
          
          <!-- M√©tricas principales -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 stats-grid">
            <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 stat-card primary">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-green-600 to-emerald-500 rounded-full flex items-center justify-center text-white shadow-lg stat-icon">
                  üí∞
                </div>
                <div class="stat-content">
                  <h3 class="text-2xl font-bold text-gray-900">{{ formatCurrency(stats.totalGastado) }}</h3>
                  <p class="text-gray-600">Total Gastado</p>
                  <small class="text-gray-500">{{ stats.totalCompras }} compras realizadas</small>
                </div>
              </div>
            </div>

            <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 stat-card success">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-500 rounded-full flex items-center justify-center text-white shadow-lg stat-icon">
                  üìä
                </div>
                <div class="stat-content">
                  <h3 class="text-2xl font-bold text-gray-900">{{ formatCurrency(stats.promedioGasto) }}</h3>
                  <p class="text-gray-600">Promedio por Compra</p>
                  <small class="text-gray-500">Basado en {{ stats.totalCompras }} compras</small>
                </div>
              </div>
            </div>

            <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 stat-card info">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-500 rounded-full flex items-center justify-center text-white shadow-lg stat-icon">
                  üìÖ
                </div>
                <div class="stat-content">
                  <h3 class="text-2xl font-bold text-gray-900">{{ stats.comprasEsteMes }}</h3>
                  <p class="text-gray-600">Compras Este Mes</p>
                  <small class="text-gray-500">{{ formatCurrency(stats.gastoEsteMes) }} gastado</small>
                </div>
              </div>
            </div>

            <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 stat-card warning">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-orange-600 to-red-500 rounded-full flex items-center justify-center text-white shadow-lg stat-icon">
                  ‚è∞
                </div>
                <div class="stat-content">
                  <h3 class="text-lg font-bold text-gray-900">{{ formatDate(stats.ultimaCompra || '') }}</h3>
                  <p class="text-gray-600">√öltima Compra</p>
                  <small class="text-gray-500">Primera: {{ formatDate(stats.primeraCompra || '') }}</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Productos favoritos -->
          <div *ngIf="stats.productosFavoritos.length > 0" class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 favorites-section">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <i class="fas fa-heart text-red-600"></i> Tus Productos Favoritos
            </h3>
            <div class="flex flex-wrap gap-3 favorites-list">
              <span 
                *ngFor="let producto of stats.productosFavoritos" 
                class="px-4 py-2 bg-gradient-to-r from-red-100 to-pink-100 text-red-800 rounded-full text-sm font-medium border border-red-200 favorite-tag">
                {{ producto }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de comentario -->
    <div *ngIf="showCommentModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 modal-overlay" (click)="closeCommentModal()">
      <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 w-full max-w-2xl max-h-[90vh] overflow-hidden modal-content" (click)="$event.stopPropagation()">
        
        <!-- Header del modal -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200/50 modal-header">
          <h3 class="text-2xl font-bold text-green-800">
            <i class="fas fa-star text-yellow-600"></i> Comentar Producto
          </h3>
          <button (click)="closeCommentModal()" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors duration-200 close-button">
            √ó
          </button>
        </div>

        <!-- Cuerpo del modal -->
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)] modal-body">
          
          <!-- Informaci√≥n del producto -->
          <div *ngIf="selectedProduct" class="bg-gradient-to-r from-green-50 to-lime-50 rounded-xl p-4 mb-6 border border-green-200/50 product-info">
            <h4 class="text-lg font-bold text-gray-900">{{ selectedProduct.nombreProducto }}</h4>
            <p class="text-gray-600">Comparte tu experiencia con este producto</p>
          </div>

          <!-- Formulario -->
          <div class="space-y-6">
            
            <!-- Calificaci√≥n -->
            <div class="form-group">
              <label class="block text-sm font-semibold text-green-800 mb-3">Calificaci√≥n:</label>
              <div class="flex items-center gap-1 rating-selector">
                <button 
                  *ngFor="let star of [1,2,3,4,5]" 
                  type="button"
                  class="text-2xl transition-all duration-200 hover:scale-110 star-button"
                  [class]="star <= commentForm.calificacion ? 'text-yellow-500 active' : 'text-gray-300 hover:text-yellow-300'"
                  (click)="commentForm.calificacion = star">
                  ‚≠ê
                </button>
              </div>
            </div>

            <!-- Comentario -->
            <div class="form-group">
              <label class="block text-sm font-semibold text-green-800 mb-2">Tu comentario:</label>
              <textarea 
                [(ngModel)]="commentForm.contenido"
                placeholder="Comparte tu experiencia con este producto..."
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white/80 backdrop-blur-sm resize-none comment-textarea"
                rows="4"
                maxlength="1000"></textarea>
              <div class="flex justify-between mt-2">
                <small class="text-gray-500">Comparte detalles espec√≠ficos sobre tu experiencia</small>
                <small class="text-gray-500">{{ commentForm.contenido.length }}/1000 caracteres</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer del modal -->
        <div class="flex gap-3 p-6 border-t border-gray-200/50 modal-footer">
          <button 
            class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-200 font-medium" 
            (click)="closeCommentModal()"
            [disabled]="submittingComment">
            Cancelar
          </button>
          <button 
            class="flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-lime-500 text-white rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed" 
            (click)="submitComment()"
            [disabled]="!commentForm.contenido.trim() || submittingComment">
            <span *ngIf="submittingComment">
              <div class="flex items-center justify-center gap-2">
                <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                Enviando...
              </div>
            </span>
            <span *ngIf="!submittingComment">
              <i class="fas fa-paper-plane"></i> Enviar Comentario
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>